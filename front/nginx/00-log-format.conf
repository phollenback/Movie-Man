# JSON log format for Azure Log Analytics compatibility
# Loads first (00- prefix) - stdout/stderr captured by Azure Container Instances
# One JSON object per line (NDJSON) for Kusto queries in Log Analytics

# Best available client IP: X-Forwarded-For when behind proxy (Azure LB etc), else remote_addr
map $http_x_forwarded_for $log_client_ip {
    ""      $remote_addr;
    default $http_x_forwarded_for;
}

log_format json_azure escape=json '{'
  '"timestamp":"$time_iso8601",'
  '"level":"INFO",'
  '"service":"movie-man-front",'
  '"project":"movie-man",'
  '"log_type":"access",'
  '"request_id":"$request_id",'
  '"client_ip":"$log_client_ip",'
  '"remote_addr":"$remote_addr",'
  '"request_method":"$request_method",'
  '"request_uri":"$request_uri",'
  '"status":$status,'
  '"body_bytes_sent":$body_bytes_sent,'
  '"request_time":$request_time,'
  '"request_length":$request_length,'
  '"http_referer":"$http_referer",'
  '"http_user_agent":"$http_user_agent"'
'}';
